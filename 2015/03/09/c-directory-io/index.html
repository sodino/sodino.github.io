
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8" />
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88" />
  
    <title>【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总 | Sodino&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Sodino">
    
    <meta name="description" content="本文内容如下：

打开文件夹
遍历文件夹下的内容
读取文件夹下的子文件(夹)文件夹位置指针的操作遍历、过滤文件夹下的子文件(夹)


文件夹关闭
删除文件夹
创建文件夹

需要用到的头文件为：#include &amp;lt;sys/types.h&amp;gt;#include &amp;lt;dirent.h&amp;gt;
">
    
    
    
    
    <link rel="alternate" href="atom.xml" title="Sodino&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='391982416296a0d54221f59fe35250d4';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Sodino&#39;s Blog">Sodino&#39;s Blog</a></h1>
				<a class="blog-motto">见多食广 与食巨近</a>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
					<li>
					
                                            <form class="search" action=http://zhannei.baidu.com/cse/search target="_blank">
                                            <label>Search</label>
                                        <input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
					
					</li>
				</ul>
                            </nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/09/c-directory-io/" title="【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总" itemprop="url">【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://sodino.com" title="Sodino">Sodino</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-09T15:00:51.000Z" itemprop="datePublished">2015 03 09</time>
    更新日期:<time datetime="2015-03-11T15:39:40.000Z" itemprop="dateModified">2015 03 11</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
		</div>
		
		<p>本文内容如下：</p>
<ul>
<li><a href="#open_dir">打开文件夹</a></li>
<li><a href="#d_list">遍历文件夹下的内容</a><blockquote>
<p><a href="#d_read">读取文件夹下的子文件(夹)</a><br><a href="#d_position">文件夹位置指针的操作</a><br><a href="#d_scan">遍历、过滤文件夹下的子文件(夹)</a></p>
</blockquote>
</li>
<li><a href="#d_close">文件夹关闭</a></li>
<li><a href="#d_rm">删除文件夹</a></li>
<li><a href="#d_mk">创建文件夹</a></li>
</ul>
<p>需要用到的头文件为：<br><code>#include &lt;sys/types.h&gt;</code><br><code>#include &lt;dirent.h&gt;</code></p>
<hr>
<p>#<a name="open_dir">打开文件夹</a></p>
<blockquote>
<p>DIR *opendir(const char *name);<br>DIR *fdopendir(int fd);</p>
</blockquote>
<p><code>opendir()</code>函数打开一个指定路径<code>name</code>的文件夹关联的流，并将该流以执行结果的方式返回给调用者。在默认情况下，该流指向文件夹下的第一个目录。<br><code>fdopendir()</code>函数与<code>opendir()</code>是相同的，只是该函数接收的方式是文件描述符<code>fd</code>。<code>fd</code>可以通过执行函数<code>int dirfd(DIR *dirp);</code>获得。需要注意的是将<code>fd</code>做为参数传递给<code>fdopendir()</code>之后，则该<code>fd</code>就不要在程序中的其它地方使用了。<br>以上两个函数正常执行时都会返回与文件夹相关联的流；否则返回NULL，错误的原因可以从<code>errno</code>中获得。</p>
<hr>
<p>#<a name="d_list">遍历文件夹下的内容</a></p>
<p>#####<a name="d_read">读取文件夹下的子文件(夹)</a></p>
<blockquote>
<p>struct dirent *readdir(DIR *dirp); <strong>NO Thread-Safe</strong><br>int readdir_r(DIR *dirp, struct dirent *entry, struct dirent **result);  <strong>Thread-Safe</strong></p>
</blockquote>
<p>执行<code>readdir()</code>函数将返回文件夹流<code>dirp</code>中的下一个条目，即文件夹下的子目录，重复执行时将会逐一返回文件夹下所有的子目录；一旦返回NULL则表示已经把所有的子目录都遍历过了或者出现了错误(可以通过<code>errno</code>查看)。<br>返回的结果是这样的一个结构体：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">struct dirent &#123;</div><div class="line">   ino_t          d_ino;       /* 在文件系统中的inode number */</div><div class="line">   off_t          d_seekoff;   /* 与文件夹流的位置指针操作相关 */</div><div class="line">   unsigned short d_reclen;    /* 本记录的数据长度 */</div><div class="line">   unsigned char  d_type;      /* 当前遍历子项的文件类型：文件、文件夹、link、socket等 */</div><div class="line">   char           d_name[256]; /* 当前遍历子项的文件名 */</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>以上结构体出自 man ,在不同系统上会有各自不同的差别。</p>
</blockquote>
<p>在上面的结构体中，文件名<code>d_name</code>的限制长度256是包括字符串终止符’\0’的，所以在OS中，文件夹的命名最大字符数是255个。(在Mac中尝试是无法输入第256个字符的)<br>结构体中的<code>d_type</code>用于标识当前的文件夹类型，支持的类型有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DT_BLK                  This is a block device.</div><div class="line">DT_CHR                  This is a character device.</div><div class="line">DT_DIR      文件夹       This is a directory.</div><div class="line">DT_FIFO                 This is a named pipe (FIFO).</div><div class="line">DT_LNK      符号链接文件  This is a symbolic link.</div><div class="line">DT_REG      文件         This is a regular file.  </div><div class="line">DT_SOCK     SOCKET链接   This is a UNIX domain socket.</div><div class="line">DT_UNKNOWN              The file type is unknown.</div></pre></td></tr></table></figure></p>
<p><code>readdir_r()</code>是<code>readdir()</code>的可重入实现版本，功能是一致的，但<code>readdir_r()</code>是线程安全的。<br>执行<code>readdir_r()</code>时遍历得到的子目录数据会存放在第二个参数<code>entry</code>中，第三个参数<code>result</code>指针指向子目录的<code>entry</code>，且函数返回值返回0。当遍历到文件夹结束的位置时，返回值仍返回0，但第三个参数<code>result</code>指针指向NULL。当函数执行错误时，则返回一个大于0的数字(即<code>EBADF</code>)。</p>
<p>#####<a name="d_position">文件夹位置指针的操作</a></p>
<blockquote>
<p>long telldir(DIR *dirp);<br>void seekdir(DIR *dirp, long loc);<br>void rewinddir(DIR *dirp);</p>
</blockquote>
<p>DIR也是流的一种，对其进行读操作时也有位置指针的概念及操作。<br><code>telldir()</code>可以获取当前的位置指针位置。返回值表示当前遍历的子目录是当前文件夹下的第几个目录(第0个是”.”当前目录，第1个是”..”上一级目录，所以从第2个开始计数。)<br><code>seekdir()</code>可以操作位置指针跳转到指定的子目录序号<code>loc</code>。<br><code>rewinddir()</code>可以将位置指针恢复到流的起始位置。</p>
<p>#####<a name="d_scan">遍历、过滤文件夹下的子文件(夹)</a></p>
<blockquote>
<p>int scandir(const char *dirp, struct dirent ***namelist,<br>    int (*filter)(const struct dirent *),<br>    int (*compar)(const struct dirent **, const struct dirent **));</p>
<p>int scandirat(int dirfd, const char *dirp, struct dirent ***namelist,<br>    int (*filter)(const struct dirent *),<br>    int (*compar)(const struct dirent **, const struct dirent **));</p>
</blockquote>
<p><code>scandir()</code>是遍历文件夹的另一种方式。本函数支持自定义遍历的过滤条件及结果排序，封闭了遍历的实现，执行后直接提供合法的目录信息，但该信息也只是目录名称而已。函数的返回结果是合法的子目录的个数；当函数执行出现错误时则返回-1且可以通过<code>errno</code>去错误详情。<br><code>dirp</code>指定要遍历的文件夹路径。<br><code>namelist</code>用于指向遍历结果。可以看出该指针指向一个二维的字符数组，该二维数组存储着文件夹下的所有合法的文件名。<br><code>*filter</code>是一个函数指针，该函数有一个参数<code>const struct dirent *</code>是指在遍历过程中所遍历到的每一个子目录<code>dirent</code>，<code>filter</code>可以根据<code>dirent</code>的类型、名称等信息来判定当前的<code>dirent</code>是否为合法的子目录，合法则函数返回0，则该子目录的名称会被存储在<code>namelist</code>中；否则返回非0，则该子目录被过滤掉。<br><code>*compar</code>也是一个函数指针，该函数的两个参数都是<code>const struct dirent *</code>用于决定两个子目录在<code>namelist</code>中的顺序。</p>
<p>C的库中也默认提供了两个文件名称排序的方法：</p>
<blockquote>
<p>int alphasort(const struct dirent **a, const struct dirent **b);<br>int versionsort(const struct dirent **a, const struct dirent **b);</p>
</blockquote>
<p><code>alphasort()</code>的实现是把<code>dirent</code>的名称用<code>strcoll()</code>进行比较，排序的结果是按ASCII编码的值由小到大排序。<br><code>versionsort()</code>的实现是把<code>dirent</code>的名称<code>strverscmp()</code>进行比较，排序的结果是也按ASCII编码的值由小到大排序，不同的是支持对名称中按数字序号的排序。举个例子对比<code>alphasort()</code>与<code>versionsort()</code>的不同：</p>
<blockquote>
<p>alphasort: pc1 <strong><em>pc10</em></strong> pc2 … pc9<br>versionsort: pc1 pc2 … pc9 <strong><em>pc10</em></strong> </p>
</blockquote>
<p>很明显，<code>versionsort()</code>的排序结果更符合普通人的阅读习惯。</p>
<p><code>scandirat()</code>是<code>scandirat()</code>的扩展函数，主要区别就在于第一个参数<code>dirfd</code>与第二个参数<code>dirp</code>。<br>如果<code>dirp</code>是一个绝对路径的字符串，则函数无视参数<code>dirfd</code>，功能与<code>scandir()</code>一致。<br>如果<code>dirp</code>是一个相对路径的字符串，且参数<code>dirfd</code>的值是<code>AT_FDCWD  (#include &lt;fcntl.h&gt;)</code>，则表示从应用程序当前的工作路径拼接上<code>dirp</code>的相对路径所组成的绝对路径下去遍历；当<code>dirfd</code>值不为<code>AT_FDCWD</code>时而是一个代替文件夹的<code>file descriptor</code>(参考<code>dirfd(DIR*)</code>)时,则遍历的文件夹路径即为<code>dirfd</code>所指向的文件夹再拼接上<code>dirp</code>的相对路径所组成的绝对路径。</p>
<p>下面的示例代码演示了<code>readdir</code> <code>readdir_r</code> <code>scandir</code>三种方式遍历文件夹的实现。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFileType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">    <span class="comment">// 子文件 类型</span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"type:%x  "</span>, type);</div><div class="line">    <span class="keyword">switch</span> (type) &#123;</div><div class="line">        <span class="keyword">case</span> DT_FIFO:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" fifo."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_CHR:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" character."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_DIR:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" directory."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_BLK:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" block."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_REG:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" regular file."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_LNK:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" link."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_SOCK:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" socket."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_WHT:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" WHT."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> DT_UNKNOWN:</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">" unknown."</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_dir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * dirPath, DIR * dir)</span> </span>&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> * <span class="title">file</span>;</span></div><div class="line">    <span class="comment">// 遍历文件夹下的内容</span></div><div class="line">    <span class="keyword">while</span> ((file = readdir(dir)) != <span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"dir position=%ld "</span>, telldir(dir));</div><div class="line">        <span class="comment">// 排队掉"."(当前目录)和".."(上一级)，无用的信息</span></div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(file-&gt;d_name, <span class="string">"."</span>) == <span class="number">0</span></div><div class="line">           || <span class="built_in">strcmp</span>(file-&gt;d_name, <span class="string">".."</span>) == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"ignore:%s \n"</span>, file-&gt;d_name);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 子文件 文件名</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"sub file:%20s  "</span>, file-&gt;d_name);</div><div class="line">        <span class="comment">// 子文件 inode节点信息</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"inode:%llx "</span>, file-&gt;d_ino);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"off:%llx  "</span>, file-&gt;d_seekoff); <span class="comment">// 和流的位置指针相关</span></div><div class="line">        printFileType(file-&gt;d_type);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_dir_r</span><span class="params">(DIR * dir)</span> </span>&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> <span class="title">entry</span>;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> * <span class="title">result</span> = &amp;<span class="title">entry</span>;</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"dir position=%ld "</span>, telldir(dir));</div><div class="line"></div><div class="line">        <span class="keyword">int</span> res = readdir_r(dir, result, &amp;result);</div><div class="line">        <span class="keyword">if</span> (res == <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">if</span> (result == <span class="literal">NULL</span>) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"sub file:%20s "</span>, entry.d_name);</div><div class="line">                printFileType(entry.d_type);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"readdir_r() fail:%s \n"</span>, strerror(errno));</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">   <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**过滤掉的“.”与".."*/</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">filterDot</span><span class="params">(<span class="keyword">const</span> struct dirent * dir)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dir-&gt;d_name,<span class="string">"."</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(dir-&gt;d_name, <span class="string">".."</span>) == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// 过滤掉 "."和".."</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_scan_dir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * path)</span> </span>&#123;</div><div class="line">    <span class="comment">// 指向字符的二维数组，该数组存储着文件夹下的合法子目录名</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> **<span class="title">namelist</span>;</span></div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    </div><div class="line">    n = scandir(path, &amp;namelist, filterDot, alphasort);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"after scandir, entry num:%d \n"</span>, n);</div><div class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</div><div class="line">        perror(<span class="string">"scandir"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> idx = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (idx !=n) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"idx=%d suf file:%20s \n"</span>, idx, namelist[idx]-&gt;d_name);</div><div class="line">            <span class="comment">// 释放掉namelist</span></div><div class="line">            <span class="built_in">free</span>(namelist[idx]);</div><div class="line">            idx ++;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 释放掉namelist</span></div><div class="line">        <span class="built_in">free</span>(namelist);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span> </span>&#123;</div><div class="line">    <span class="comment">// 指定的一个文件夹路径</span></div><div class="line">    <span class="keyword">char</span> * dirPath = <span class="string">"/Users/sodino/workspace/xcode/CString/CString/test"</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// 打开文件夹</span></div><div class="line">    DIR* dir = opendir(dirPath);</div><div class="line">    print_dir(dirPath, dir);</div><div class="line">    </div><div class="line">    <span class="comment">// 重置文件夹位置指针至流的起始位置，以便后续再次遍历</span></div><div class="line">    rewinddir(dir);</div><div class="line">    </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n\ndo rewinddir() and go on to list entry(s)\n\n"</span>);</div><div class="line">    print_dir_r(dir);</div><div class="line">    </div><div class="line">    <span class="comment">// 重置文件夹位置指针至流的起始位置，以便后续再次遍历</span></div><div class="line">    rewinddir(dir);</div><div class="line">    </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n\n do scandir() \n"</span>);</div><div class="line">    print_scan_dir(dirPath);</div><div class="line">    </div><div class="line">    <span class="comment">// 关闭</span></div><div class="line">    closedir(dir);</div><div class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下图：<br><img src="http://ww2.sinaimg.cn/mw1024/e3dc9ceagw1eq26hf1cjbj20j60cun2j.jpg" alt="directory"></p>
<hr>
<p>#<a name="d_close">文件夹关闭</a></p>
<blockquote>
<p>int closedir(DIR *dirp);</p>
</blockquote>
<p><code>closedir()</code>将关闭一个与文件夹相关联的流。执行本函数后，<code>dirp</code>将不可再被使用。</p>
<hr>
<p>#<a name="d_rm">删除文件夹</a></p>
<blockquote>
<p>int rmdir(const char *pathname);<br>删除指定路径下的文件夹。如果删除成功，则返回0；否则返回-1，并可通过<code>errno</code>查看失败原因。</p>
</blockquote>
<hr>
<p>#<a name="d_mk">创建文件夹</a></p>
<blockquote>
<p>int mkdir(const char *pathname, mode_t mode);<br>int mkdirat(int dirfd, const char *pathname, mode_t mode);</p>
</blockquote>
<p><code>mkdir()</code>函数用于创建文件夹，参数<code>pathname</code>指定要创建的文件夹的绝对路径。参数<code>mode</code>用于限定文件夹的文件权限(组)。该<code>mode</code>将会OR操作后合成<code>struct stat</code>中的<code>st_mode</code>(<a href="http://sodino.com/2015/03/06/c-file-detail-info/">详情</a>)。文件权限(组)的<code>mode</code>具体定义见下文的<a href="#d_file_mode">File Mode Bits</a>(懒得翻译了，直接上英文)。所设置的文件权限(组)可以通过命令<code>ls -l -a</code>查看。<br>如果函数正常执行并创建文件夹成功，则返回0；否则返回-1并且可以通过<code>errno</code>查看错误详情。</p>
<blockquote>
<p>扩展：直接mkdir(path, S_IRWXU| S_IRWXG| S_IRWXO),可生成的文件夹权限组是<code>drwxr-xr-x</code>而不是<code>drwxrwxrwx</code>?</p>
</blockquote>
<p>原因是：<code>mkdir()</code>函数中指定的参数<code>mode</code>值会和当前程序的<code>umask</code>处理一下，具体处理为<code>mode &amp; ~unmask &amp; 0777</code>才是最终的文件夹权限组。查看当前用户或程序的<code>umask</code>可以在命令行终端上输入命令<code>umask</code>可看。一般用户的<code>umask</code>值为<code>0022</code>。</p>
<p><code>mkdirat()</code>函数是<code>mkdir()</code>的扩展，参数中<code>dirfd</code>与<code>pathname</code>的用法跟 <code>scandir()</code>与<code>scandirat()</code>的用法是一致的，这里就不重复说明了。</p>
<p>#####<a name="d_file_mode">File Mode Bits:#####</a></p>
<blockquote>
<p>S_IRWXU        read, write, execute/search by <strong><em>owner</em></strong><br>S_IRUSR        read permission, <strong><em>owner</em></strong><br>S_IWUSR        write permission, <strong><em>owner</em></strong><br>S_IXUSR        execute/search permission, <strong><em>owner</em></strong><br>S_IRWXG        read, write, execute/search by <strong>group</strong><br>S_IRGRP        read permission, <strong>group</strong><br>S_IWGRP        write permission, <strong>group</strong><br>S_IXGRP        execute/search permission, <strong>group</strong><br>S_IRWXO        read, write, execute/search by <strong><em>others</em></strong><br>S_IROTH        read permission, <strong><em>others</em></strong><br>S_IWOTH        write permission, <strong><em>others</em></strong><br>S_IXOTH        execute/search permission, <strong><em>others</em></strong><br>S_ISUID        set-user-ID on execution<br>S_ISGID        set-group-ID on execution<br>S_ISVTX        on directories, restricted deletion flag</p>
</blockquote>
<p>The bits defined by S_IRUSR, S_IWUSR, S_IXUSR, S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH, S_ISUID, S_ISGID  and S_ISVTX are unique.<br>S_IRWXU is the bitwise OR of S_IRUSR, S_IWUSR and S_IXUSR.<br>S_IRWXG is the bitwise OR of S_IRGRP, S_IWGRP and S_IXGRP.<br>S_IRWXO is the bitwise OR of S_IROTH, S_IWOTH and S_IXOTH.</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/C-C/">C/C++</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/C-C/">C/C++</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://sodino.com/2015/03/09/c-directory-io/" data-title="【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总 | Sodino&#39;s Blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/14/c-macro/" title="【C/C++】宏(macro)定义与使用">
  <strong>PREVIOUS:</strong><br/>
  <span>
  【C/C++】宏(macro)定义与使用</span>
</a>
</div>


<div class="next">
<a href="/2015/03/07/c-file-io/"  title="【C/C++】文件创建、打开、读、写、复制、关闭、删除等操作汇总">
 <strong>NEXT:</strong><br/> 
 <span>【C/C++】文件创建、打开、读、写、复制、关闭、删除等操作汇总
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list" class="clearfix">
		
		<a href="http://weibo.com/3822886122" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/sodino" target="_blank" title="github"></a>
		
		
		
	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/android/" title="Android">Android<sup>13</sup></a></li>
		
			<li><a href="/categories/AndroidStudio/" title="AndroidStudio">AndroidStudio<sup>5</sup></a></li>
		
			<li><a href="/categories/C-C/" title="C/C++">C/C++<sup>26</sup></a></li>
		
			<li><a href="/categories/Eclipse/" title="Eclipse">Eclipse<sup>1</sup></a></li>
		
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		
			<li><a href="/categories/JDK/" title="JDK">JDK<sup>1</sup></a></li>
		
			<li><a href="/categories/JNI/" title="JNI">JNI<sup>2</sup></a></li>
		
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>6</sup></a></li>
		
			<li><a href="/categories/LBS/" title="LBS">LBS<sup>1</sup></a></li>
		
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>7</sup></a></li>
		
			<li><a href="/categories/Mac/" title="Mac">Mac<sup>2</sup></a></li>
		
			<li><a href="/categories/Node-js/" title="Node.js">Node.js<sup>17</sup></a></li>
		
			<li><a href="/categories/Proguard/" title="Proguard">Proguard<sup>2</sup></a></li>
		
			<li><a href="/categories/React-Native/" title="React-Native">React-Native<sup>1</sup></a></li>
		
			<li><a href="/categories/blog/" title="blog">blog<sup>3</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>18</sup></a></li>
		
			<li><a href="/tags/AndroidStudio/" title="AndroidStudio">AndroidStudio<sup>5</sup></a></li>
		
			<li><a href="/tags/C-C/" title="C/C++">C/C++<sup>25</sup></a></li>
		
			<li><a href="/tags/Eclipse/" title="Eclipse">Eclipse<sup>1</sup></a></li>
		
			<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		
			<li><a href="/tags/JDK/" title="JDK">JDK<sup>1</sup></a></li>
		
			<li><a href="/tags/JNI/" title="JNI">JNI<sup>2</sup></a></li>
		
			<li><a href="/tags/Java/" title="Java">Java<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>6</sup></a></li>
		
			<li><a href="/tags/LBS/" title="LBS">LBS<sup>1</sup></a></li>
		
			<li><a href="/tags/Linux/" title="Linux">Linux<sup>7</sup></a></li>
		
			<li><a href="/tags/Mac/" title="Mac">Mac<sup>2</sup></a></li>
		
			<li><a href="/tags/NDK/" title="NDK">NDK<sup>1</sup></a></li>
		
			<li><a href="/tags/Node-js/" title="Node.js">Node.js<sup>17</sup></a></li>
		
			<li><a href="/tags/Proguard/" title="Proguard">Proguard<sup>2</sup></a></li>
		
			<li><a href="/tags/React-Native/" title="React-Native">React-Native<sup>1</sup></a></li>
		
			<li><a href="/tags/object-Object/" title="[object Object]">[object Object]<sup>1</sup></a></li>
		
			<li><a href="/tags/blog/" title="blog">blog<sup>3</sup></a></li>
		
			<li><a href="/tags/markdown/" title="markdown">markdown<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://blog.csdn.net/sodino" target="_blank" title="Sodino Csdn">CSDN's Blog</a></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Android/" style="font-size: 18.75px;">Android</a> <a href="/tags/AndroidStudio/" style="font-size: 13.75px;">AndroidStudio</a> <a href="/tags/C-C/" style="font-size: 20px;">C/C++</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JNI/" style="font-size: 11.25px;">JNI</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/LBS/" style="font-size: 10px;">LBS</a> <a href="/tags/Linux/" style="font-size: 16.25px;">Linux</a> <a href="/tags/Mac/" style="font-size: 11.25px;">Mac</a> <a href="/tags/NDK/" style="font-size: 10px;">NDK</a> <a href="/tags/Node-js/" style="font-size: 17.5px;">Node.js</a> <a href="/tags/Proguard/" style="font-size: 11.25px;">Proguard</a> <a href="/tags/React-Native/" style="font-size: 10px;">React-Native</a> <a href="/tags/object-Object/" style="font-size: 10px;">[object Object]</a> <a href="/tags/blog/" style="font-size: 12.5px;">blog</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
    
            <p class="copyright"> © 2018 
		
		<a href="http://sodino.com" target="_blank" title="Sodino">Sodino</a>
		
            && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"sodino"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





<script>
    
        var _bdImg = '4';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"分享：",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  </body>
</html>

