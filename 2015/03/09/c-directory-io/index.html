<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><script data-ad-client="ca-pub-9442633619132398" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script data-ad-client="ca-pub-9442633619132398" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Sodino的个人博客"><title>【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总 | Sodino's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总</h1><a id="logo" href="/.">Sodino's Blog</a><p class="description">见多食广 与食巨近</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【C/C++】文件夹的打开、遍历、删除、创建、关闭操作汇总</h1><div class="post-meta">Mar 9, 2015<span> | </span><span class="category"><a href="/categories/C-C/">C/C++</a></span></div><div class="post-content"><p>本文内容如下：</p>
<ul>
<li><a href="#open_dir">打开文件夹</a></li>
<li><a href="#d_list">遍历文件夹下的内容</a><blockquote>
<p><a href="#d_read">读取文件夹下的子文件(夹)</a><br><a href="#d_position">文件夹位置指针的操作</a><br><a href="#d_scan">遍历、过滤文件夹下的子文件(夹)</a></p>
</blockquote>
</li>
<li><a href="#d_close">文件夹关闭</a></li>
<li><a href="#d_rm">删除文件夹</a></li>
<li><a href="#d_mk">创建文件夹</a></li>
</ul>
<p>需要用到的头文件为：<br><code>#include &lt;sys/types.h&gt;</code><br><code>#include &lt;dirent.h&gt;</code></p>
<hr>
<p>#<a name="open_dir">打开文件夹</a></p>
<blockquote>
<p>DIR *opendir(const char *name);<br>DIR *fdopendir(int fd);</p>
</blockquote>
<p><code>opendir()</code>函数打开一个指定路径<code>name</code>的文件夹关联的流，并将该流以执行结果的方式返回给调用者。在默认情况下，该流指向文件夹下的第一个目录。<br><code>fdopendir()</code>函数与<code>opendir()</code>是相同的，只是该函数接收的方式是文件描述符<code>fd</code>。<code>fd</code>可以通过执行函数<code>int dirfd(DIR *dirp);</code>获得。需要注意的是将<code>fd</code>做为参数传递给<code>fdopendir()</code>之后，则该<code>fd</code>就不要在程序中的其它地方使用了。<br>以上两个函数正常执行时都会返回与文件夹相关联的流；否则返回NULL，错误的原因可以从<code>errno</code>中获得。</p>
<hr>
<p>#<a name="d_list">遍历文件夹下的内容<br>#####<a name="d_read">读取文件夹下的子文件(夹)</a></a></p>
<blockquote>
<p>struct dirent *readdir(DIR *dirp); <strong>NO Thread-Safe</strong><br>int readdir_r(DIR *dirp, struct dirent *entry, struct dirent **result);  <strong>Thread-Safe</strong></p>
</blockquote>
<p>执行<code>readdir()</code>函数将返回文件夹流<code>dirp</code>中的下一个条目，即文件夹下的子目录，重复执行时将会逐一返回文件夹下所有的子目录；一旦返回NULL则表示已经把所有的子目录都遍历过了或者出现了错误(可以通过<code>errno</code>查看)。<br>返回的结果是这样的一个结构体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct dirent &#123;</span><br><span class="line">   ino_t          d_ino;       /* 在文件系统中的inode number */</span><br><span class="line">   off_t          d_seekoff;   /* 与文件夹流的位置指针操作相关 */</span><br><span class="line">   unsigned short d_reclen;    /* 本记录的数据长度 */</span><br><span class="line">   unsigned char  d_type;      /* 当前遍历子项的文件类型：文件、文件夹、link、socket等 */</span><br><span class="line">   char           d_name[256]; /* 当前遍历子项的文件名 */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上结构体出自 man ,在不同系统上会有各自不同的差别。</p>
</blockquote>
<p>在上面的结构体中，文件名<code>d_name</code>的限制长度256是包括字符串终止符’\0’的，所以在OS中，文件夹的命名最大字符数是255个。(在Mac中尝试是无法输入第256个字符的)<br>结构体中的<code>d_type</code>用于标识当前的文件夹类型，支持的类型有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DT_BLK                  This is a block device.</span><br><span class="line">DT_CHR                  This is a character device.</span><br><span class="line">DT_DIR      文件夹       This is a directory.</span><br><span class="line">DT_FIFO                 This is a named pipe (FIFO).</span><br><span class="line">DT_LNK      符号链接文件  This is a symbolic link.</span><br><span class="line">DT_REG      文件         This is a regular file.  </span><br><span class="line">DT_SOCK     SOCKET链接   This is a UNIX domain socket.</span><br><span class="line">DT_UNKNOWN              The file type is unknown.</span><br></pre></td></tr></table></figure>

<p><code>readdir_r()</code>是<code>readdir()</code>的可重入实现版本，功能是一致的，但<code>readdir_r()</code>是线程安全的。<br>执行<code>readdir_r()</code>时遍历得到的子目录数据会存放在第二个参数<code>entry</code>中，第三个参数<code>result</code>指针指向子目录的<code>entry</code>，且函数返回值返回0。当遍历到文件夹结束的位置时，返回值仍返回0，但第三个参数<code>result</code>指针指向NULL。当函数执行错误时，则返回一个大于0的数字(即<code>EBADF</code>)。</p>
<p>#####<a name="d_position">文件夹位置指针的操作</a></p>
<blockquote>
<p>long telldir(DIR *dirp);<br>void seekdir(DIR *dirp, long loc);<br>void rewinddir(DIR *dirp);</p>
</blockquote>
<p>DIR也是流的一种，对其进行读操作时也有位置指针的概念及操作。<br><code>telldir()</code>可以获取当前的位置指针位置。返回值表示当前遍历的子目录是当前文件夹下的第几个目录(第0个是”.”当前目录，第1个是”..”上一级目录，所以从第2个开始计数。)<br><code>seekdir()</code>可以操作位置指针跳转到指定的子目录序号<code>loc</code>。<br><code>rewinddir()</code>可以将位置指针恢复到流的起始位置。</p>
<p>#####<a name="d_scan">遍历、过滤文件夹下的子文件(夹)</a></p>
<blockquote>
<p>int scandir(const char *dirp, struct dirent ***namelist,<br>    int (*filter)(const struct dirent *),<br>    int (*compar)(const struct dirent **, const struct dirent **));</p>
</blockquote>
<blockquote>
<p>int scandirat(int dirfd, const char *dirp, struct dirent ***namelist,<br>    int (*filter)(const struct dirent *),<br>    int (*compar)(const struct dirent **, const struct dirent **));</p>
</blockquote>
<p><code>scandir()</code>是遍历文件夹的另一种方式。本函数支持自定义遍历的过滤条件及结果排序，封闭了遍历的实现，执行后直接提供合法的目录信息，但该信息也只是目录名称而已。函数的返回结果是合法的子目录的个数；当函数执行出现错误时则返回-1且可以通过<code>errno</code>去错误详情。<br><code>dirp</code>指定要遍历的文件夹路径。<br><code>namelist</code>用于指向遍历结果。可以看出该指针指向一个二维的字符数组，该二维数组存储着文件夹下的所有合法的文件名。<br><code>*filter</code>是一个函数指针，该函数有一个参数<code>const struct dirent *</code>是指在遍历过程中所遍历到的每一个子目录<code>dirent</code>，<code>filter</code>可以根据<code>dirent</code>的类型、名称等信息来判定当前的<code>dirent</code>是否为合法的子目录，合法则函数返回0，则该子目录的名称会被存储在<code>namelist</code>中；否则返回非0，则该子目录被过滤掉。<br><code>*compar</code>也是一个函数指针，该函数的两个参数都是<code>const struct dirent *</code>用于决定两个子目录在<code>namelist</code>中的顺序。</p>
<p>C的库中也默认提供了两个文件名称排序的方法：</p>
<blockquote>
<p>int alphasort(const struct dirent **a, const struct dirent **b);<br>int versionsort(const struct dirent **a, const struct dirent **b);</p>
</blockquote>
<p><code>alphasort()</code>的实现是把<code>dirent</code>的名称用<code>strcoll()</code>进行比较，排序的结果是按ASCII编码的值由小到大排序。<br><code>versionsort()</code>的实现是把<code>dirent</code>的名称<code>strverscmp()</code>进行比较，排序的结果是也按ASCII编码的值由小到大排序，不同的是支持对名称中按数字序号的排序。举个例子对比<code>alphasort()</code>与<code>versionsort()</code>的不同：</p>
<blockquote>
<p>alphasort: pc1 <strong><em>pc10</em></strong> pc2 … pc9<br>versionsort: pc1 pc2 … pc9 <strong><em>pc10</em></strong> </p>
</blockquote>
<p>很明显，<code>versionsort()</code>的排序结果更符合普通人的阅读习惯。</p>
<p><code>scandirat()</code>是<code>scandirat()</code>的扩展函数，主要区别就在于第一个参数<code>dirfd</code>与第二个参数<code>dirp</code>。<br>如果<code>dirp</code>是一个绝对路径的字符串，则函数无视参数<code>dirfd</code>，功能与<code>scandir()</code>一致。<br>如果<code>dirp</code>是一个相对路径的字符串，且参数<code>dirfd</code>的值是<code>AT_FDCWD  (#include &lt;fcntl.h&gt;)</code>，则表示从应用程序当前的工作路径拼接上<code>dirp</code>的相对路径所组成的绝对路径下去遍历；当<code>dirfd</code>值不为<code>AT_FDCWD</code>时而是一个代替文件夹的<code>file descriptor</code>(参考<code>dirfd(DIR*)</code>)时,则遍历的文件夹路径即为<code>dirfd</code>所指向的文件夹再拼接上<code>dirp</code>的相对路径所组成的绝对路径。</p>
<p>下面的示例代码演示了<code>readdir</code> <code>readdir_r</code> <code>scandir</code>三种方式遍历文件夹的实现。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFileType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 子文件 类型</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"type:%x  "</span>, type);</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> DT_FIFO:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" fifo."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_CHR:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" character."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_DIR:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" directory."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_BLK:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" block."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_REG:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" regular file."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_LNK:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" link."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_SOCK:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" socket."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_WHT:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" WHT."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DT_UNKNOWN:</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" unknown."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_dir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * dirPath, DIR * dir)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> * <span class="title">file</span>;</span></span><br><span class="line">    <span class="comment">// 遍历文件夹下的内容</span></span><br><span class="line">    <span class="keyword">while</span> ((file = readdir(dir)) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"dir position=%ld "</span>, telldir(dir));</span><br><span class="line">        <span class="comment">// 排队掉"."(当前目录)和".."(上一级)，无用的信息</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(file-&gt;d_name, <span class="string">"."</span>) == <span class="number">0</span></span><br><span class="line">           || <span class="built_in">strcmp</span>(file-&gt;d_name, <span class="string">".."</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ignore:%s \n"</span>, file-&gt;d_name);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 子文件 文件名</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"sub file:%20s  "</span>, file-&gt;d_name);</span><br><span class="line">        <span class="comment">// 子文件 inode节点信息</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"inode:%llx "</span>, file-&gt;d_ino);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"off:%llx  "</span>, file-&gt;d_seekoff); <span class="comment">// 和流的位置指针相关</span></span><br><span class="line">        printFileType(file-&gt;d_type);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_dir_r</span><span class="params">(DIR * dir)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> <span class="title">entry</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> * <span class="title">result</span> = &amp;<span class="title">entry</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"dir position=%ld "</span>, telldir(dir));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> res = readdir_r(dir, result, &amp;result);</span><br><span class="line">        <span class="keyword">if</span> (res == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"sub file:%20s "</span>, entry.d_name);</span><br><span class="line">                printFileType(entry.d_type);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"readdir_r() fail:%s \n"</span>, strerror(errno));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**过滤掉的“.”与".."*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">filterDot</span><span class="params">(<span class="keyword">const</span> struct dirent * dir)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dir-&gt;d_name,<span class="string">"."</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(dir-&gt;d_name, <span class="string">".."</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 过滤掉 "."和".."</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_scan_dir</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * path)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 指向字符的二维数组，该数组存储着文件夹下的合法子目录名</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> **<span class="title">namelist</span>;</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    </span><br><span class="line">    n = scandir(path, &amp;namelist, filterDot, alphasort);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"after scandir, entry num:%d \n"</span>, n);</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">"scandir"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (idx !=n) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"idx=%d suf file:%20s \n"</span>, idx, namelist[idx]-&gt;d_name);</span><br><span class="line">            <span class="comment">// 释放掉namelist</span></span><br><span class="line">            <span class="built_in">free</span>(namelist[idx]);</span><br><span class="line">            idx ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 释放掉namelist</span></span><br><span class="line">        <span class="built_in">free</span>(namelist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 指定的一个文件夹路径</span></span><br><span class="line">    <span class="keyword">char</span> * dirPath = <span class="string">"/Users/sodino/workspace/xcode/CString/CString/test"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 打开文件夹</span></span><br><span class="line">    DIR* dir = opendir(dirPath);</span><br><span class="line">    print_dir(dirPath, dir);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重置文件夹位置指针至流的起始位置，以便后续再次遍历</span></span><br><span class="line">    rewinddir(dir);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n\ndo rewinddir() and go on to list entry(s)\n\n"</span>);</span><br><span class="line">    print_dir_r(dir);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重置文件夹位置指针至流的起始位置，以便后续再次遍历</span></span><br><span class="line">    rewinddir(dir);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n\n do scandir() \n"</span>);</span><br><span class="line">    print_scan_dir(dirPath);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关闭</span></span><br><span class="line">    closedir(dir);</span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下图：<br><img src="http://ww2.sinaimg.cn/mw1024/e3dc9ceagw1eq26hf1cjbj20j60cun2j.jpg" alt="directory"></p>
<hr>
<p>#<a name="d_close">文件夹关闭</a></p>
<blockquote>
<p>int closedir(DIR *dirp);</p>
</blockquote>
<p><code>closedir()</code>将关闭一个与文件夹相关联的流。执行本函数后，<code>dirp</code>将不可再被使用。</p>
<hr>
<p>#<a name="d_rm">删除文件夹</a></p>
<blockquote>
<p>int rmdir(const char *pathname);<br>删除指定路径下的文件夹。如果删除成功，则返回0；否则返回-1，并可通过<code>errno</code>查看失败原因。</p>
</blockquote>
<hr>
<p>#<a name="d_mk">创建文件夹</a></p>
<blockquote>
<p>int mkdir(const char *pathname, mode_t mode);<br>int mkdirat(int dirfd, const char *pathname, mode_t mode);</p>
</blockquote>
<p><code>mkdir()</code>函数用于创建文件夹，参数<code>pathname</code>指定要创建的文件夹的绝对路径。参数<code>mode</code>用于限定文件夹的文件权限(组)。该<code>mode</code>将会OR操作后合成<code>struct stat</code>中的<code>st_mode</code>(<a href="http://sodino.com/2015/03/06/c-file-detail-info/">详情</a>)。文件权限(组)的<code>mode</code>具体定义见下文的<a href="#d_file_mode">File Mode Bits</a>(懒得翻译了，直接上英文)。所设置的文件权限(组)可以通过命令<code>ls -l -a</code>查看。<br>如果函数正常执行并创建文件夹成功，则返回0；否则返回-1并且可以通过<code>errno</code>查看错误详情。</p>
<blockquote>
<p>扩展：直接mkdir(path, S_IRWXU| S_IRWXG| S_IRWXO),可生成的文件夹权限组是<code>drwxr-xr-x</code>而不是<code>drwxrwxrwx</code>?</p>
</blockquote>
<p>原因是：<code>mkdir()</code>函数中指定的参数<code>mode</code>值会和当前程序的<code>umask</code>处理一下，具体处理为<code>mode &amp; ~unmask &amp; 0777</code>才是最终的文件夹权限组。查看当前用户或程序的<code>umask</code>可以在命令行终端上输入命令<code>umask</code>可看。一般用户的<code>umask</code>值为<code>0022</code>。</p>
<p><code>mkdirat()</code>函数是<code>mkdir()</code>的扩展，参数中<code>dirfd</code>与<code>pathname</code>的用法跟 <code>scandir()</code>与<code>scandirat()</code>的用法是一致的，这里就不重复说明了。</p>
<p>#####<a name="d_file_mode">File Mode Bits:#####</a></p>
<blockquote>
<p>S_IRWXU        read, write, execute/search by <strong><em>owner</em></strong><br>S_IRUSR        read permission, <strong><em>owner</em></strong><br>S_IWUSR        write permission, <strong><em>owner</em></strong><br>S_IXUSR        execute/search permission, <strong><em>owner</em></strong><br>S_IRWXG        read, write, execute/search by <strong>group</strong><br>S_IRGRP        read permission, <strong>group</strong><br>S_IWGRP        write permission, <strong>group</strong><br>S_IXGRP        execute/search permission, <strong>group</strong><br>S_IRWXO        read, write, execute/search by <strong><em>others</em></strong><br>S_IROTH        read permission, <strong><em>others</em></strong><br>S_IWOTH        write permission, <strong><em>others</em></strong><br>S_IXOTH        execute/search permission, <strong><em>others</em></strong><br>S_ISUID        set-user-ID on execution<br>S_ISGID        set-group-ID on execution<br>S_ISVTX        on directories, restricted deletion flag</p>
</blockquote>
<p>The bits defined by S_IRUSR, S_IWUSR, S_IXUSR, S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH, S_ISUID, S_ISGID  and S_ISVTX are unique.<br>S_IRWXU is the bitwise OR of S_IRUSR, S_IWUSR and S_IXUSR.<br>S_IRWXG is the bitwise OR of S_IRGRP, S_IWGRP and S_IXGRP.<br>S_IRWXO is the bitwise OR of S_IROTH, S_IWOTH and S_IXOTH.</p>
</div><div class="tags"><a href="/tags/C-C/">C/C++</a></div><div class="post-nav"><a class="pre" href="/2015/03/14/c-macro/">【C/C++】宏(macro)定义与使用</a><a class="next" href="/2015/03/07/c-file-io/">【C/C++】文件创建、打开、读、写、复制、关闭、删除等操作汇总</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://sodino.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/AndroidStudio/">AndroidStudio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JDK/">JDK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JNI/">JNI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LBS/">LBS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Proguard/">Proguard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React-Native/">React-Native</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/AndroidStudio/" style="font-size: 15px;">AndroidStudio</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/object-Object/" style="font-size: 15px;">[object Object]</a> <a href="/tags/NDK/" style="font-size: 15px;">NDK</a> <a href="/tags/JNI/" style="font-size: 15px;">JNI</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/LBS/" style="font-size: 15px;">LBS</a> <a href="/tags/JDK/" style="font-size: 15px;">JDK</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Proguard/" style="font-size: 15px;">Proguard</a> <a href="/tags/React-Native/" style="font-size: 15px;">React-Native</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/react-native-provide-custom-config-4-fresco/">【Android】React-Native为Fresco的初始化提供自定义的Configuration</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/dexcount/">【Android】方法数查看工具---DexCount</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/retrofit-notes/">【Android】Retrofit 的一些笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/20/android-transparent-statusbar/">【Android】透明状态栏在App中的实现与接口设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/android-ripple/">【Android】Ripple使用总结及ClickableSpan的冲突解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/14/react-native-es6-Solidot/">【React-Native】开源的入门项目 Solidot</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/android-mediaPlayer-2-bugs/">【Android】记录Android MediaPlayer的两个bug及其它特殊表现</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/android-gradle-change-appName/">【Android】Gadle改变应用名称(appName)的两种方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/mongo-background-service/">【Linux】启动mongo db后台服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/yum-uninstall-mongodb/">【Linux】yum卸载mongodb及后续问题的解决</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.csdn.net/sodino" title="CSDN's blog" target="_blank">CSDN's blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Sodino's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>